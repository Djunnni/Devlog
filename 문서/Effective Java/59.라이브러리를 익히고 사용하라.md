## 라이브러리를 익히고 사용하라

무작위 정수 하나를 생성하고 싶다고 해보자.값의 범위는 0부터 명시한 수 사이다. 아주 흔히 마주치는 문제로, 많은 프로그래머가 다음과 같은 짤막한 메서드를 만들곤 한다.

```java
static Random rnd = new Random();

static int random(int i) {
    return Math.abs(rnd.nextInt()) % i;
 }
```

괜찮은 듯 보여도 문제를 3가지 내포하고 있다.

1) i의 크기가 그리 크지 않은 2의 제곱수라면 얼마 지나지 않아 같은 수열이 반복된다.
2) 2의 제곱수가 아니라면 몇몇 숫자가 평균적으로 더 자주 반복된다.i의 값이 크면 이 현상은 더 두드러진다.

예시를 위해 필자가 신중히 선택한 범위에서 무작위 수를 백만개를 생성한 다음, 그 중간 값보다 작은게 몇개인지를 출력한다.

```java
public static void main(String[] args) {
    int n = 2 * (Integer.MAX_VALUE / 3);
    int low = 0;
    for(int i = 1; i < 1000000; i++) {
        if(random(n) < n / 2) {
            low++;
        }
    }
    System.out.println(low);
}
```

random 메서드가 이상적으로 동작한다면 약 50만개가 출력돼야 하지만, 실제로 돌려보면 666,666에 가까운 값을 얻는다. 무작위로 생성된 수 중에서 2/3가량이 중간값보다 낮은 쪽으로 쏠린 것이다.
> 내 PC에서는 50만 4백개 정도가 잡히는데 다른 PC에서는 어떻게 나올 지 모르겠다. 추가적으로 rnd.nextInt(i)로만 해도 0~i-1까지 잡힌다.

3) 지정한 범위 바깥의 수가 종종 튀어나올 수 있다. rnd.nextInt()가 반환하는 값을 Math.abs를 이용해 음수가 아닌 정수로 매핑하기 때문이다. nextInt가 Integer.MIN_VALUE를 반환하면 Math.abs도 Integer.MIN_VALUE를 반환하고 나머지 연산자(%)는 음수를 반환해버린다.

이 결함을 해결하려면 의사난수 생성기, 정수론, 2의 보수 계산 등에 조예가 깊어야한다. 다행히 여러분들이 직접해결할 필요는 없다. Random.nextInt(i)가 이미 해결해 놨으니 때문이다.
> 위에서 집은 내용이 여기서 나오다니 ;)

알고리즘에 능통한 개발자가 설계와 구현과 검증에 시간을 들여 개발했고, 이 분야의 여러 전문가가 잘 동작함을 검증해줬다. 그리고 이 라이브러리가 릴리스된 후 20년동안 수많은 개발자가 사용했지만 버그가 보고된 적이 없다.

**표준라이브러리를 사용하면 그 코드를 작성한 전문가의 지식과 여러분보다 앞서 사용한 다른 프로그래머들의 경험을 활용할 수 있다.**

자바 7부턴 더이상 Random을 사용하지 않는게 좋다. ThreadLocalRandom으로 대체하면 대부분 잘 작동한다. Random보다 더 고품질의 무작위 수를 생성할 뿐 아니라 속도도 더 빠르다. 한편, 포크-조인 풀이나 병렬스트림에서는 SplittableRandom을 사용하라

표준 라이브러리를 쓰는 두번째 이점은 핵심적인 일과 크게 관련없는 문제를 해결하느라 시간을 허비하지 않아도 된다는 것이다. 

세번째 이점은 따로 노력하지 않아도 성능이 지속해서 개선된다는 점이다. 사용자가 많고 업계 표준 벤치마크를 사용해 성능을 확인하기 때문에 표준 라이브러리 제작자들은 더 나은 방법을 꾸준히 모색할 수 밖에 없다.

자바 플랫폼 라이브러리의 많은 부분이 수년에 걸쳐 지속해서 다시 작성되며 때론 성능이 극적으로 개선되기도 한다.

내번째 이점은 기능이 점점 많아진다는 것이다. 라이브러리에 부족한 부분이 있다면 개발자 커뮤니티에서 이야기가 나오고 논의된 후 다음 릴리스에 해당 기능이 추가되곤 한다.

마지막 이점은 여러분이 작성한 코드가 많은 사람에게 낯익은 코드가 된다는 것이다. 자연스럽게 다른 개발자들이 더 읽기 좋고 유지보수하기 좋고 재활용하기 쉬운 코드가 된다.

이상의 이점들에 비춰볼 때, 표준 라이브러리의 기능을 사용하는 것이 좋아 보이지만, 실상은 많은 프로그래머가 직접 구현해 쓰고 있다. 왜 그럴까?

아마도 라이브러리에 그런 기능이 있는지 모르기 때문일 것이다. 메이저 릴리스마다 주목할 만한 수많은 기능이 라이브러리에 추가된다.

잡바는 메이저 릴리스마다 새로운 기능을 설명하는 웹페이지를 공시하는데, 한 번쯤 읽어볼만 하다.

적어도 java.lang, java.util, java.io와 그 하위 패키지 들에는 익숙해져야 한다.

때때로 라이브러리가 필요한 기능을 충분히 제공하지 못할 때도 있다. 더 전문적인 기능을 요구할 수록 이런일이 더 자주 생길 것이다.

구글의 guava 라이브러리 등 서드파티도 생각해보고 선택지가 없으면 직접 구현하자.