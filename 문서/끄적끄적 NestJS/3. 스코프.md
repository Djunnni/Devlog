# 스코프

## 1. Node.js 환경

Node.js환경에서 다른 웹 프레임워크와는 달리, 멀티 스레드 비저장 모델을 따르지 않고 있습니다. 싱글턴 인스턴스를 사용하는 것은 안전한 방법이며 요청으로 들어올 시 모든 정보(DB 커넥션 풀, 전역 싱글턴 서비스)를 공유할 수 있다는 장점이 있습니다.

하지만 GraphQL 경우 요청별 캐싱을 한다거나 요청을 추적하거나 또는 멀티테넌시를 지원하기 위해서는 요청 기반으로 생명주기를 제한하기도 해야한다.

| 멀티태넌시는 인스턴스가 여러 사용자에게 다르게 동작하도록 하는 SW 아키텍쳐 방법이다. 각 사용자마다 인스턴스가 새롭게 만들어지도록 하는 멀티 인스턴스 방식도 있다. 요즘 대부분 서비스는 멀티 태넌시를 사용함.

## 2. 스코프의 종류

1. DEFAULT

싱글턴 인스턴스가 전체 어플리케이션에서 공유됨. 수명은 어플리케이션 생명주기와 같으며 어플리케이션이 부트스트랩 과정을 마치면 모든 싱글턴 프로바이더의 인스턴스가 만들어진다. 별도 선언하지 않으면 기본

2. REQUEST

들어오는 요청마다 별도의 인스턴스가 생성. 요청을 처리하고 나면 인스턴스는 GC 처리

3. TRANSIENT

임시의 의미로 인스턴스가 공유되지 않는다. 이 프로바이더를 주입하는 각 컴포넌트는 새로생성된 전용 인스턴스를 주입받게 된다.

## 3. 사용방법

```ts
import { Injectable, Scope } from '@nestjs/common';

@Injectable({ scope: Scope.REQUEST })
export class CatService {}
```

