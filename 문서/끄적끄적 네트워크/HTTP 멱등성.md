# HTTP 멱등성

### 멱등성이란?

컴퓨터에서 멱등성은 같은 로직을 반복수행해도 항상 같은 결과값이 도출된다는 특성을 가지고 있습니다.
```
ex) 

2 * 1 -> 2
2 * 1 * 1 -> 2
2 * 1^n -> 2

이러한 여러번을 수행해도 처음과 같은 값을 반환하는 걸 멱등 함수라 한다.
```

### HTTP 멱등성

HTTP 메서드에서도 멱등성을 보장하는 메서드들이 있다. HTTP에서의 멱등성이란 Request로 부터 리소스에 변화를 주거나 조회를 할 때도 항상 동일한 결과를 반환할 수 있는지의 여부다.

|메서드| 멱등성 여부|
|----|---------|
| GET | O |
| PUT | O |
| DELETE | O |
| HEAD | O |
| OPTIONS | O |
| TRACE | O |
| POST | X |
| PATCH | X |
|CONNECT| X |

PUT은 리소스에 대한 내용의 전체변경을 의미하고 있어 여러번 호출해도 항상 같은 리소스로 반환되기 때문에 결과가 달라지지 않습니다. 

DELETE 역시 리소스에 대한 전체삭제를 의미하며 여러번 호출해도 삭제된 리소스에대해 결과가 달라지지 않습니다.

서버 데이터를 변경하는 POST, PATCH는 호출할 때마다 응답이 달라지기에 멱등한 메서드가 아닙니다. 멱등하지 않는 메서드에 멱등성을 보장하려면 구현해야합니다.

> 안정성과 멱등성은 어떻게 다른가?
> 안전성이란 리소스를 변경하지 않는다. 그래서 GET, HEAD, OPTIONS는 안전하다.
> 안전성이 보장된다는건 멱등성도 보장한다.
> 멱등성을 보장하는건 안전성을 보장하지 못한다 왜냐하면 PUT, DELETE는 리소스에 변화를 일으키기 때문이다.

### API 관점에서

멱등한 API라면 2번이상 요청이 와도 처음요청과 똑같이 리턴됩니다. 단순히 돌아온 값이 같을 뿐 아니라 DB 상태에도 영향을 미치지 않습니다.

이렇게 시스템에 의도하지 않고 요청을 재시도 할 수 있어 멱등성은 결함이 없고 안전한 API를 만드는데 중요합니다.

실수로 중복된 요청이 발생해도 실제로 결제가 발생하지않아 안심하고 여러번 요청도 가능합니다.

### 어떻게 멱등한 방법이지?

멱등키를 API에 포함하면 된다. IETF (The Internet Task Force)에서는 요청 헤더에 포함하는 방법을 표준으로 제안하고 있다.


### 참고

https://velog.io/@tosspayments/%EB%A9%B1%EB%93%B1%EC%84%B1%EC%9D%B4-%EB%AD%94%EA%B0%80%EC%9A%94